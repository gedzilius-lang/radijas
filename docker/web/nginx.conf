server {
    listen 80;

    root /var/www/player;
    index index.html;

    # HLS streaming â€” use root-based approach to avoid alias+nested location issues
    location /hls/ {
        root /var/www;
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
        add_header Access-Control-Expose-Headers "Content-Length,Content-Range" always;
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        # Playlists: no cache
        if ($request_filename ~* \.m3u8$) {
            add_header Cache-Control "no-cache, no-store" always;
            add_header Access-Control-Allow-Origin * always;
        }
    }

    # API: status endpoint
    location = /api/status {
        alias /var/www/status/status.json;
        default_type application/json;
        add_header Cache-Control "no-cache, no-store" always;
        add_header Access-Control-Allow-Origin * always;
    }

    # API: nowplaying
    location = /api/nowplaying {
        alias /var/www/status/nowplaying;
        default_type application/json;
        add_header Cache-Control "no-cache, no-store" always;
        add_header Access-Control-Allow-Origin * always;
    }

    location / {
        try_files $uri $uri/ /index.html;
    }
}
